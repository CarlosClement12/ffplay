***************
*** 939,950 ****
  static void video_image_display(VideoState *is)
  {
      Frame *vp;
      Frame *sp;
      SDL_Rect rect;
      int i;
  
      vp = frame_queue_peek(&is->pictq);
      if (vp->bmp) {
          if (is->subtitle_st) {
              if (frame_queue_nb_remaining(&is->subpq) > 0) {
                  sp = frame_queue_peek(&is->subpq);
--- 1040,1056 ----
  static void video_image_display(VideoState *is)
  {
      Frame *vp;
+ #ifdef SUBTITLE
      Frame *sp;
+ #endif
      SDL_Rect rect;
+ #ifdef SUBTITLE
      int i;
+ #endif
  
      vp = frame_queue_peek(&is->pictq);
      if (vp->bmp) {
+ #ifdef SUBTITLE
          if (is->subtitle_st) {
              if (frame_queue_nb_remaining(&is->subpq) > 0) {
                  sp = frame_queue_peek(&is->subpq);
***************
*** 1574,1588 ****
              if (frame_queue_nb_remaining(&is->pictq) > 1) {
                  Frame *nextvp = frame_queue_peek_next(&is->pictq);
                  duration = vp_duration(is, vp, nextvp);
-                 if(!is->step && (redisplay || framedrop>0 || (framedrop && get_master_sync_type(is) != AV_SYNC_VIDEO_MASTER)) && time > is->frame_timer + duration){
                      if (!redisplay)
                          is->frame_drops_late++;
                      frame_queue_next(&is->pictq);
                      redisplay = 0;
                      goto retry;
                  }
              }
  
              if (is->subtitle_st) {
                      while (frame_queue_nb_remaining(&is->subpq) > 0) {
                          sp = frame_queue_peek(&is->subpq);
--- 1756,1777 ----
              if (frame_queue_nb_remaining(&is->pictq) > 1) {
                  Frame *nextvp = frame_queue_peek_next(&is->pictq);
                  duration = vp_duration(is, vp, nextvp);
+                 if(!is->step && (redisplay
+ #ifdef FRAMEDROP
+                                  || framedrop>0 || (framedrop && get_master_sync_type(is) != AV_SYNC_VIDEO_MASTER)
+ #endif
+                                  ) && time > is->frame_timer + duration){
+ #ifdef FRAMEDROP
                      if (!redisplay)
                          is->frame_drops_late++;
+ #endif
                      frame_queue_next(&is->pictq);
                      redisplay = 0;
                      goto retry;
                  }
              }
  
+ #ifdef SUBTITLE
              if (is->subtitle_st) {
                      while (frame_queue_nb_remaining(&is->subpq) > 0) {
                          sp = frame_queue_peek(&is->subpq);
***************
*** 3070,3080 ****
  
          /* if the queue are full, no need to read more */
          if (infinite_buffer<1 &&
-               (is->audioq.size + is->videoq.size + is->subtitleq.size > MAX_QUEUE_SIZE
-             || (   (is->audioq   .nb_packets > MIN_FRAMES || is->audio_stream < 0 || is->audioq.abort_request)
-                 && (is->videoq   .nb_packets > MIN_FRAMES || is->video_stream < 0 || is->videoq.abort_request
                      || (is->video_st->disposition & AV_DISPOSITION_ATTACHED_PIC))
-                 && (is->subtitleq.nb_packets > MIN_FRAMES || is->subtitle_stream < 0 || is->subtitleq.abort_request)))) {
              /* wait 10 ms */
              SDL_LockMutex(wait_mutex);
              SDL_CondWaitTimeout(is->continue_read_thread, wait_mutex, 10);
--- 3328,3353 ----
  
          /* if the queue are full, no need to read more */
          if (infinite_buffer<1 &&
+               (
+ #ifdef AUDIO
+                   is->audioq.size +
+ #endif
+                   is->videoq.size
+ #ifdef SUBTITLE
+                   + is->subtitleq.size
+ #endif
+                   > MAX_QUEUE_SIZE
+             || (
+ #ifdef AUDIO
+                    (is->audioq   .nb_packets > MIN_FRAMES || is->audio_stream < 0 || is->audioq.abort_request)
+                 &&
+ #endif
+                    (is->videoq   .nb_packets > MIN_FRAMES || is->video_stream < 0 || is->videoq.abort_request
                      || (is->video_st->disposition & AV_DISPOSITION_ATTACHED_PIC))
+ #ifdef SUBTITLE
+                 && (is->subtitleq.nb_packets > MIN_FRAMES || is->subtitle_stream < 0 || is->subtitleq.abort_request)
+ #endif
+                 ))) {
              /* wait 10 ms */
              SDL_LockMutex(wait_mutex);
              SDL_CondWaitTimeout(is->continue_read_thread, wait_mutex, 10);
***************
*** 3248,3260 ****
          if (st->codec->codec_type == codec_type) {
              /* check that parameters are OK */
              switch (codec_type) {
              case AVMEDIA_TYPE_AUDIO:
                  if (st->codec->sample_rate != 0 &&
                      st->codec->channels != 0)
                      goto the_end;
                  break;
              case AVMEDIA_TYPE_VIDEO:
              case AVMEDIA_TYPE_SUBTITLE:
                  goto the_end;
              default:
                  break;
--- 3553,3569 ----
          if (st->codec->codec_type == codec_type) {
              /* check that parameters are OK */
              switch (codec_type) {
+ #ifdef AUDIO
              case AVMEDIA_TYPE_AUDIO:
                  if (st->codec->sample_rate != 0 &&
                      st->codec->channels != 0)
                      goto the_end;
                  break;
+ #endif
              case AVMEDIA_TYPE_VIDEO:
+ #ifdef SUBTITLE
              case AVMEDIA_TYPE_SUBTITLE:
+ #endif
                  goto the_end;
              default:
                  break;
***************
*** 3809,3816 ****
          video_disable = 1;
      }
      flags = SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER;
      if (audio_disable)
          flags &= ~SDL_INIT_AUDIO;
      if (display_disable)
          SDL_putenv(dummy_videodriver); /* For the event queue, we always need a video driver. */
  #if !defined(_WIN32) && !defined(__APPLE__)
--- 4172,4181 ----
          video_disable = 1;
      }
      flags = SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER;
+ #ifdef AUDIO
      if (audio_disable)
          flags &= ~SDL_INIT_AUDIO;
+ #endif
      if (display_disable)
          SDL_putenv(dummy_videodriver); /* For the event queue, we always need a video driver. */
  #if !defined(_WIN32) && !defined(__APPLE__)
